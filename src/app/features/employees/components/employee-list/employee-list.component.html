<div class="container pt-5 pb-5">
  <div class="page-card">

    <!-- タイトル -->
    <div class="row mb-5 mt-4 align-items-center">
      <div class="col mb-2 mb-md-0">
        <h1 class="mb-0 border-bottom pb-2 d-flex align-items-center">
          <app-icon name="users_bk" class="title-icon me-3"></app-icon>
          従業員 一覧
        </h1>
      </div>

      <div class="col-auto d-flex flex-column flex-md-row align-items-md-center justify-content-md-end">
        <app-button
          label="追加"
          icon="user-plus"
          color="blue"
          size="md"
          [block]="true"
          [routerLink]="'/employees/new'"
          class="me-md-3 mb-2 mb-md-0">
        </app-button>
      </div>
    </div>

    <!-- データ取得後のみ表示（チラつき防止） -->
    <div *ngIf="dataLoaded">

      <table mat-table
             [dataSource]="dataSource"
             matSort
             class="app-table w-100">

        <!-- 社員番号 -->
        <ng-container matColumnDef="code">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            社員番号
          </th>
          <td mat-cell *matCellDef="let emp">
            {{ emp.code }}
          </td>
        </ng-container>

        <!-- 氏名 -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            氏名
          </th>
          <td mat-cell *matCellDef="let emp">
            {{ emp.lastName }} {{ emp.firstName }}
          </td>
        </ng-container>

        <!-- 所属 -->
        <ng-container matColumnDef="department">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            所属
          </th>
          <td mat-cell *matCellDef="let emp">
            {{ emp.departmentName }}
          </td>
        </ng-container>

        <!-- 雇用状態 -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>
            雇用状態
          </th>
          <td mat-cell *matCellDef="let emp">
            {{ statusLabel(emp.employmentStatus) }}
          </td>
        </ng-container>

        <!-- システム利用 -->
        <ng-container matColumnDef="system">
          <th mat-header-cell *matHeaderCellDef>
            システム利用可否
          </th>
          <td mat-cell *matCellDef="let emp">
            <span *ngIf="emp.active" class="badge bg-success">
              利用可能
            </span>
            <span *ngIf="!emp.active" class="badge bg-secondary">
              利用停止
            </span>
          </td>
        </ng-container>

        <!-- 操作 -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let emp" class="text-end">

          <div class="d-flex justify-content-end align-items-center gap-2">

            <!-- ロック中表示 -->
            <ng-container *ngIf="emp.locked">

              <span class="badge bg-danger">
                ロック中
              </span>

              <small class="text-danger">
                {{ remainingTime(emp.lockUntil) }}
              </small>

              <app-button
                label="解除"
                icon="lock-open"
                color="red"
                size="sm"
                (click)="unlock(emp.code)">
              </app-button>

            </ng-container>

            <!-- 詳細は常に表示 -->
            <app-button
              label="詳細"
              icon="user_bk"
              color="yellow"
              size="sm"
              [routerLink]="['/employees', emp.code]">
            </app-button>

          </div>

        </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row
            *matRowDef="let row; columns: displayedColumns"
            [class.table-secondary]="!row.active">
        </tr>

      </table>

    </div>

  </div>
</div>