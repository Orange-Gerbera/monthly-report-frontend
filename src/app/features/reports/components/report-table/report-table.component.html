<div class="container mt-4">
  <div class="row">
    <div class="col-12 col-md-12 offset-md-0">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="d-flex align-items-center mb-0">
          <app-icon name="document-duplicate_bk" class="me-2"></app-icon>
          報告書一覧
        </h1>

        <div *ngIf="dueDateOfCurrentMonth as due" class="text-end">
          <small class="text-muted">
            {{ currentMonth }}月の提出期日:<br />
            {{ formatDate(due.toString(), "datetimeWithDay") }}
          </small>
        </div>
      </div>

      <div class="table-responsive">
        <mat-paginator
          [pageSizeOptions]="[5, 10, 25]"
          [pageSize]="10"
          showFirstLastButtons
        ></mat-paginator>
        <table
          mat-table
          [dataSource]="dataSource"
          matSort
          class="w-100 app-table"
        >
          <ng-container matColumnDef="reportMonth">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>日付</th>
            <td mat-cell *matCellDef="let report">
              {{ formatDate(report.reportMonth, "month") }}
            </td>
          </ng-container>

          <ng-container matColumnDef="dueDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>提出期日</th>
            <td mat-cell *matCellDef="let report">
              <ng-container *ngIf="report.dueDate">
                {{ formatDate(report.dueDate, "datetime") }}
              </ng-container>
            </td>
          </ng-container>

          <ng-container matColumnDef="submittedAt">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>提出日</th>
            <td mat-cell *matCellDef="let report">
              <ng-container *ngIf="report.completeFlg && report.submittedAt; else unsubmittedText">
                {{ report.submittedAt | date : "yyyy/MM/dd" }}
              </ng-container>
              <ng-template #unsubmittedText>
                <span>未提出</span>
              </ng-template>
            </td>
          </ng-container>

          <ng-container matColumnDef="completeFlg">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>完了</th>
            <td mat-cell *matCellDef="let report">
              <app-icon *ngIf="report.completeFlg" name="check_bk"></app-icon>
            </td>
          </ng-container>

          <ng-container matColumnDef="approvalFlg">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>承認</th>
            <td mat-cell *matCellDef="let report">
              <ng-container [ngSwitch]="report.approvalFlg">
                <app-icon *ngSwitchCase="true" name="check_bk"></app-icon>
                <span *ngSwitchCase="false" class="text-danger">否認</span>
              </ng-container>
            </td>
          </ng-container>

          <ng-container matColumnDef="comment">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>コメント</th>
            <td mat-cell *matCellDef="let report">
              <app-icon *ngIf="report.comment" name="check_bk"></app-icon>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="text-center actions-col"></th>
            <td mat-cell *matCellDef="let report" class="text-center">
              <div class="d-flex justify-content-center">
                <app-button
                  *ngIf="report.id"
                  label="報告書"
                  icon="document-text_bk"
                  color="yellow"
                  size="md"
                  [state]="{ previousUrl: previousUrl }"
                  [routerLink]="['/reports', report.id]"
                ></app-button>
                <span *ngIf="!report.id" class="py-2">未作成</span>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let report; columns: displayedColumns"></tr>
        </table>
      </div>

      <ng-template #noReports>
        <p>データが存在しません。</p>
      </ng-template>
    </div>
  </div>
</div>